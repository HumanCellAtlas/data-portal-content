---
path: "/learn/userguides/secondary-analysis/optimus-prime-workflow-in-detail"
date: "2018-05-03"
title: "Optimus Prime Workflow in Detail"
---

## Description of 3-prime scRNA sequencing


## Overview of our Pipeline-building Strategy

We are building pipeline technologies to support RNA sequencing of cells isolated using Drop-seq. This particular pipeline is designed to identify and quantify reads generated by 3’ scRNA-seq, and augment the input data with metadata derived during the processing steps. Rather than remove reads determined by the pipeline to be of lesser quality, all reads are kept with their associated metadata and incorporated into the output files. Thus, for example, reads that do not align with genes are not removed. This design, which differs from most pipelines currently available, enables use of the entire dataset by those who may be less interested in specific biological questions and more interested in computational aspects of the data.

## Quick Start Table

| Pipeline Features | Description | Source |
|-------------------|---------------------------------------------------------------|-----------------------|
| Overall Workflow  |Quality control module and transcriptome quantification module | Code available from [Github](https://github.com/HumanCellAtlas/skylab/blob/master/pipelines/optimus/Optimus.wdl) |
| Workflow Language |WDL          |[openWDL](https://github.com/openwdl/wdl)|
| Genomic Reference Sequence|GRCh38 human genome primary sequence|Link (external) Link (blue box)|
|Transcriptomic Reference Sequence |V27 GenCode human transcriptome |Link (external) Link (blue box)|
| Aligner           |STAR       |[Dobin, et al.,2013](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3530905/)|
| Transcript Quantification |        |                                              |                       |
|Data Input File Format | FASTQ      |                                              |                       |
|Run Time               |            |                                              |                       |

## Pipeline Overview

This workflow processes 3’ sequencing data generated from the 10X Genomics1 v2 assay. It corrects cell barcodes and UMIs (unique molecular identifiers), aligns reads, marks duplicates, and returns data as alignments in BAM file format and as counts in sparse matrix exchange format. The pipeline is described below and summarized in the figure; [the code](https://github.com/HumanCellAtlas/skylab/blob/master/pipelines/optimus/Optimus.wdl) is available from Github.

## Cell Barcode Correction

Although the function of the cell barcodes is to identify unique cells, several barcode errors, such as incorporation of the barcode into contaminating DNA or sequencing and PCR errors can arise, make it challenging to distinguish unique cells from artifactual appearances of the barcode. The first step of this pipeline is to correct for cell barcode errors.

Cell barcode correction uses as input files in BAM file format; thus the fastq files containing the raw sequence data from the sequencer must first be converted to BAM files. This is done using the FastqToUBam.wdl tool, described [here](https://software.broadinstitute.org/gatk/documentation/tooldocs/4.0.3.0/picard_sam_FastqToSam.php). The output BAM files contain sequence that is complementary to the mRNA transcript data in the fastq files and can thus be aligned to the genomic sequence in a later alignment step.

The [Attach10xBarcodes](https://github.com/HumanCellAtlas/sctools) tool is then used to attach 10X barcodes found in the fastq sample to the corresponding reads in the BAM file, producing a barcoded.bam file. The tool uses as input three files:1) the original fastq file of forward reads (r1), containing the unique molecular identifier and cell barcode sequences, 2) an index fastq file which contains the Illumina sample barcodes, and 3) the unmapped bam file of reverse reads (r2), which is the alignable genomic information. The reads in these files are in the same order, and the tool works sequentially through the data, putting the barcodes found for each read of the first 2 fastq files  onto the corresponding read of the third (BAM) file.  The program returns as output a barcoded.bam file containing the reads with correct barcodes (this includes barcodes that came within one error of matching, which are corrected by this tool). These are assigned a “CB” tag. Uncorrected barcodes are preserved and given a “CR” (Cell barcode Raw) tag. During this process, barcoded reads are sorted into cell groups so that the data is divided into reads per cell chunks.

## Alignment

The [STAR](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3530905/) alignment software is then used to map the reads to the genome, using the GRCh38 human genome primary sequence as reference. STAR (Spliced Transcripts Alignment to a Reference) is widely-used for RNA-seq alignment and generates transcript count information as well as gene identification assignments. Alignment to the V27 GenCode transcriptomic reference is also performed using the [HISAT2](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4655817/) software to ensure that actual biotypes (and not pseudogenes, for example) are identified.

## Metrics

A number of quality control tools are used to assess the quality of the data output each time this pipeline is run. For a list of the tools and information about each one please see [this page] of our documentation.
